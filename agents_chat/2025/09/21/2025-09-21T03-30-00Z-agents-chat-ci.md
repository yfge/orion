---
id: 2025-09-21T03-30-00Z-agents-chat-ci
date: 2025-09-21T03:30:00Z
participants: [human, orion-assistant]
models: [gpt-4o]
tags: [ci, process, agents_chat]
related_paths:
  - AGENTS.md
  - .github/workflows/commitlint.yml
  - tools/ci/check-agents-chat.js
summary: "Enforce agents_chat to be included in the same commit as code changes via CI"
---

User original prompt and requirements
- 用户要求：更新流程，之后 agents_chat 必须与代码更改同一次提交提交。

Background and goals
- 将规范固化到 CI，避免遗漏；提供必要的 bypass 方式以减少噪音。

Changes
- AGENTS.md：新增 “CI enforcement (agents_chat coupling)” 章节，明确规则与例外。
- .github/workflows/commitlint.yml：加入 `check-agents-chat.js` 执行步骤，PR 和 push 均执行。
- tools/ci/check-agents-chat.js：实现检查逻辑：若单个提交修改了 backend/frontend/Docker/docker-compose.yml 之一，则同一提交必须包含 agents_chat/ 变更；允许在提交说明中包含 `skip agents-chat` 以绕过。

Outcome and impact
- 提交粒度与审计日志强关联，提升可追踪性；兼顾实操与 CI 稳定性。

Next steps (TODO)
- 后续可根据团队反馈微调路径列表和例外条件；为 “trivial changes” 定义更精确的自动识别策略。

Linked commits/PRs
- 本次提交同捆绑定上述修改，满足新规。

